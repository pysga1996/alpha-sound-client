<div class="row">
  <div class="card col-sm-12">
    <div class="card-header">
      <h4 class="text-center">Album</h4>
    </div>
    <div class="card-body">
      <form [formGroup]="albumForm" (ngSubmit)="onSubmit()">
        <div class="form-group">
          <label for="albumTitle">Album Title</label>
          <input type="text" class="form-control" id="albumTitle" placeholder="Enter album title" formControlName="title">
        </div>

        <label>Artist</label>
        <div formArrayName="artists"
             *ngFor="let artist of getAlbumArtists().controls; let i = index;">
          <div [formGroupName]="i" >
            <mat-form-field color="accent" floatLabel="auto" appearance="outline" class="col-sm-10 px-0">
              <input (focus)="suggestAlbumArtist(i)" class="form-control" matInput [matAutocomplete]="autoAlbum" aria-label="Song" id="albumArtistName" type="text" [formControl]="getAlbumArtists().controls[i]" [placeholder]="'Artist ' + (i + 1) + ' name'">
              <mat-autocomplete #autoAlbum="matAutocomplete" [displayWith]="displayFn">
                <mat-option *ngIf="isAlbumLoading" class="is-loading"><mat-spinner diameter="25"></mat-spinner></mat-option>
                <ng-container *ngIf="!isAlbumLoading">
                  <mat-option *ngFor="let artist of filteredAlbumArtists" [value]="artist">
                    <span>{{ artist.name }}</span>
                    <small> | ID: {{artist.id}}</small>
                  </mat-option>
                </ng-container>
              </mat-autocomplete>
            </mat-form-field>
            <button type="button" class="btn btn-info col-sm-1" (click)="addAlbumArtist()">+</button>
            <button type="button" class="btn btn-danger col-sm-1" (click)="removeAlbumArtist(i)" *ngIf="getAlbumArtists().controls.length > 1">-</button>
          </div>
        </div>
        <div class="form-group">
          <label for="albumReleaseDate">Release Date</label>
          <input type="date" class="form-control" id="albumReleaseDate" placeholder="Release Date" formControlName="releaseDate">
        </div>
        <div class="form-group">
          <label class="col-sm-4 px-0" for="albumCover">Cover</label>
          <div class="custom-file">
            <input type="file" class="custom-file-input" id="albumCover" placeholder="Upload album cover" (change)="selectImage($event)">
            <label class="custom-file-label" for="albumCover" *ngIf=!isImageFileChosen>Choose file</label>
            <label class="custom-file-label" for="albumCover" *ngIf=isImageFileChosen>{{ imageFileName }}</label>
          </div>
        </div>
        <div class="col-sm-3">
          <button type="submit" class="btn btn-primary mb-2">Submit</button>
          <span *ngIf="albumMessage">{{ albumMessage }}</span>
        </div>
        <div class="col-sm-9">
          <!-- Progress Bar -->
          <div class="progress form-group col-sm-9" *ngIf="albumProgress > 0">
            <div class="progress-bar progress-bar-striped bg-success" role="progressbar" [style.width.%]="albumProgress">
            </div>
          </div>
        </div>
      </form>
    </div>
  </div>

</div>
<div *ngFor="let form of songsForm, index as j" >
  <div class="row" style="margin-bottom: 10rem;">
    <div class="card col-sm-12" #card1>
      <div class="card-header">
        <h4 class="text-center">#{{ j + 1 }} Song</h4>
      </div>
      <div class="card-body">
        <button class="btn btn-info float-sm-right" style="margin-bottom: 1rem" (click)="removeForm(j)"><i class="fas fa-times-circle"></i></button>
        <form [formGroup]="songsForm[j]">
          <table class="table table-striped">
            <tr class="row">
              <td class="col-sm-4"><label for="songName">Song Name</label></td>
              <td class="col-sm-8"><input type="text" class="form-control" id="songName" placeholder="Enter song name" formControlName="name"></td>
            </tr>
            <!--            <tr class="row">-->
            <!--              <td class="col-sm-4"><label for="artistName">Artist Name</label></td>-->
            <!--              <td class="col-sm-8"><input type="text" class="form-control" id="artistName" placeholder="Multiple artists separated by commas" formControlName="artists"></td>-->
            <!--            </tr>-->
            <tr class="row">
              <td class="col-sm-4">Artist Name</td>
              <td class="col-sm-8">
                <label>Artist</label>
                <div formArrayName="artists" class="form-group"
                     *ngFor="let artist of getSongArtists(j).controls; let k = index;">
                  <div [formGroupName]="k">
                    <mat-form-field>
                      <input (focus)="suggestSongArtist(j, k)" matInput [matAutocomplete]="autoSong" class="form-control" aria-label="Song" type="text" [formControl]="getSongArtists(j).controls[k]" [placeholder]="'Artist ' + (k + 1) + ' name'">
                      <mat-autocomplete #autoSong="matAutocomplete" [displayWith]="displayFn">
                        <mat-option *ngIf="isSongLoading[j][k]" class="is-loading"><mat-spinner diameter="25"></mat-spinner></mat-option>
                        <ng-container *ngIf="!isSongLoading[j][k]">
                          <mat-option *ngFor="let artist of filteredSongArtist[j]" [value]="artist">
                            <span>{{ artist.name }}</span>
                            <small> | ID: {{artist.id}}</small>
                          </mat-option>
                        </ng-container>
                      </mat-autocomplete>
                    </mat-form-field>
                    <button type="button" class="btn btn-info" (click)="addSongArtist(j)">+</button>
                    <button type="button" class="btn btn-danger" (click)="removeSongArtist(j, k)" *ngIf="getSongArtists(j).controls.length > 1">-</button>
                  </div>
                </div>
              </td>
            </tr>
            <tr class="row">
              <td class="col-sm-4"><label for="releaseDate">Release Date</label></td>
              <td class="col-sm-8"><input type="date" class="form-control" id="releaseDate" placeholder="yyyy-mm-dd" formControlName="releaseDate"></td>
            </tr>
            <tr class="row">
              <td class="col-sm-4"><label for="audio">Audio File</label></td>
              <td class="col-sm-8">
                <div class="custom-file">
                  <input type="file" class="custom-file-input" id="audio" (change)="selectAudio($event, j)">
                  <label class="custom-file-label" *ngIf=!isAudioFileChosen[j]>Choose file</label>
                  <label class="custom-file-label" *ngIf=isAudioFileChosen[j]>{{ audioFileNames[j] }}</label>
                </div>
              </td>
            </tr>
          </table>
<!--          <input type="hidden" formControlName="album">-->
          <span *ngIf="songsMessage[j]">{{ songsMessage[j] }}</span>
          <!-- Progress Bar -->
          <div class="progress form-group" *ngIf="songsProgress[j] > 0">
            <div class="progress-bar progress-bar-striped bg-success" role="progressbar" [style.width.%]="songsProgress[j]">
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<div class="row">
  <div class="card col-sm-12" #card2>
    <div class="card-body d-flex p-2 justify-content-center">
      <button class="align-self-center btn btn-info" (click)="addForm()"><i class="fas fa-plus-circle fa-4x"></i></button>
    </div>
  </div>
</div>



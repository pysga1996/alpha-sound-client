<div class="row">
  <div class="card col-sm-12">
    <div class="card-header">
      <h4 class="text-center">{{ 'Upload Album' | translate }}</h4>
    </div>
    <div class="card-body">
      <form [formGroup]="albumForm" (ngSubmit)="onSubmit()">
        <div class="form-group">
          <label for="albumTitle">{{ 'Title' | translate }}</label>
          <input type="text" class="form-control" id="albumTitle" [placeholder]="('Enter' | translate) + ' ' + ('Album title' | translate)" formControlName="title">
        </div>
        <label>{{ 'Artist' | translate }}</label>
        <div formArrayName="artists"
             *ngFor="let artist of getAlbumArtists().controls; let i = index;">
          <div [formGroupName]="i" >
            <mat-form-field color="accent" floatLabel="auto" appearance="outline" class="col-sm-10 px-0">
              <input (focus)="suggestAlbumArtist(i)" class="form-control" matInput [matAutocomplete]="autoAlbum" aria-label="Song" id="albumArtistName" type="text" [formControl]="getAlbumArtists().controls[i]" [placeholder]="('Enter' | translate) + ' ' + ('Artist Name' | translate)">
              <mat-autocomplete #autoAlbum="matAutocomplete" [displayWith]="displayFn">
                <mat-option *ngIf="isAlbumLoading" class="is-loading"><mat-spinner diameter="25"></mat-spinner></mat-option>
                <ng-container *ngIf="!isAlbumLoading">
                  <mat-option *ngFor="let artist of filteredAlbumArtists" [value]="artist">
                    <span>{{ artist.name }}</span>
                    <img style="vertical-align:middle;" aria-hidden [src]="artist.avatarUrl" height="40" alt=""/>
                  </mat-option>
                </ng-container>
              </mat-autocomplete>
            </mat-form-field>
            <button type="button" class="btn btn-info col-sm-1" (click)="addAlbumArtist()">+</button>
            <button type="button" class="btn btn-danger col-sm-1" (click)="removeAlbumArtist(i)" *ngIf="getAlbumArtists().controls.length > 1">-</button>
          </div>
        </div>
        <div class="form-group">
          <label for="albumReleaseDate">{{ 'Release Date' | translate }}</label>
          <input type="date" class="form-control" id="albumReleaseDate" placeholder="Release Date" formControlName="releaseDate">
        </div>
        <div class="form-group">
          <label class="col-sm-4 px-0" for="albumCover">{{ 'Cover' | translate }}</label>
          <div class="custom-file">
            <input type="file" class="custom-file-input" id="albumCover" [placeholder]="'Image File' | translate" (change)="selectImage($event)">
            <label class="custom-file-label" for="albumCover" *ngIf=!isImageFileChosen>{{ 'Choose File' | translate }}</label>
            <label class="custom-file-label" for="albumCover" *ngIf=isImageFileChosen>{{ imageFileName }}</label>
          </div>
        </div>
        <div class="col-sm-3">
          <button type="submit" class="btn btn-primary mb-2">{{ 'Submit' | translate }}</button>
          <span *ngIf="albumMessage">{{ albumMessage | translate }}</span>
        </div>
        <div class="col-sm-9">
          <!-- Progress Bar -->
          <div class="progress form-group col-sm-9" *ngIf="albumProgress.value > 0">
            <div class="progress-bar progress-bar-striped bg-success" role="progressbar" [style.width.%]="albumProgress.value"></div>
          </div>
          <div *ngIf="albumMessage" class="alert mt-3 mb-0" [class.alert-danger]="albumError"
               [class.alert-success]="!albumError">{{ albumMessage | translate }}
          </div>
        </div>
      </form>
    </div>
  </div>
</div>
<div *ngFor="let form of songsForm, index as j" >
  <div class="row" style="margin-bottom: 10rem;">
    <div class="card col-sm-12" #card1>
      <div class="card-header">
        <h4 class="text-center">{{ 'Song' | translate }} #{{ j + 1 }}</h4>
      </div>
      <div class="card-body">
        <button class="btn btn-info float-sm-right" style="margin-bottom: 1rem" (click)="removeForm(j)"><i class="fas fa-times-circle"></i></button>
        <form [formGroup]="songsForm[j]">
          <div class="form-group">
            <label for="songTitle">{{ 'Title' | translate }}</label>
            <input type="text" class="form-control" id="songTitle" placeholder="Enter song name" formControlName="title">
          </div>
          <div class="form-group">
            <label>{{ 'Artist' | translate }}</label>
            <div formArrayName="artists" class="form-group"
                 *ngFor="let artist of getSongArtists(j).controls; let k = index;">
              <div [formGroupName]="k">
                <mat-form-field color="accent" floatLabel="auto" appearance="outline" class="col-sm-10 px-0">
                  <input (focus)="suggestSongArtist(j, k)" matInput [matAutocomplete]="autoSong" class="form-control" aria-label="Song" type="text" [formControl]="getSongArtists(j).controls[k]" [placeholder]="('Enter' | translate) + ' ' + ('Artist Name' | translate)">
                  <mat-autocomplete #autoSong="matAutocomplete" [displayWith]="displayFn">
                    <mat-option *ngIf="isSongLoading[j][k]" class="is-loading"><mat-spinner diameter="25"></mat-spinner></mat-option>
                    <ng-container *ngIf="!isSongLoading[j][k]">
                      <mat-option *ngFor="let artist of filteredSongArtist[j]" [value]="artist">
                        <span>{{ artist.name }}</span>
                        <img style="vertical-align:middle;" aria-hidden [src]="artist.avatarUrl" height="40" alt=""/>
                      </mat-option>
                    </ng-container>
                  </mat-autocomplete>
                </mat-form-field>
                <button type="button" class="btn btn-info col-sm-1" (click)="addSongArtist(j)">+</button>
                <button type="button" class="btn btn-danger col-sm-1" (click)="removeSongArtist(j, k)" *ngIf="getSongArtists(j).controls.length > 1">-</button>
              </div>
            </div>
          </div>
          <div class="form-group">
            <label for="releaseDate">{{ 'Release Date' | translate }}</label>
            <input type="date" class="form-control" id="releaseDate" [placeholder]="('Pick' | translate) + ' ' + ('Release Date' | translate)" formControlName="releaseDate">
          </div>
          <div class="form-group">
            <label for="audio">{{ 'Audio File' | translate }}</label>
            <div class="custom-file">
              <input type="file" class="custom-file-input" id="audio" (change)="selectAudio($event, j)">
              <label class="custom-file-label" *ngIf=!isAudioFileChosen[j]>{{ 'Choose File' | translate }}</label>
              <label class="custom-file-label" *ngIf=isAudioFileChosen[j]>{{ audioFileNames[j] }}</label>
            </div>
          </div>
          <div *ngIf="songsMessage[j]" class="alert mt-3 mb-0" [class.alert-danger]="songError[j]"
               [class.alert-success]="!songError[j]">{{ songsMessage[j] | translate }}
          </div>
          <!-- Progress Bar -->
          <div class="progress form-group" *ngIf="songsProgress[j].value > 0">
            <div class="progress-bar progress-bar-striped bg-success" role="progressbar" [style.width.%]="songsProgress[j].value">
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<div class="row">
  <div class="card col-sm-12" #card2>
    <div class="card-body d-flex p-2 justify-content-center">
      <button class="align-self-center btn btn-info" (click)="addForm()"><i class="fas fa-plus-circle fa-4x"></i></button>
    </div>
  </div>
</div>


